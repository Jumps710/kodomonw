<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>拠点名を登録してください</title>
    <script src="https://static.line-scdn.net/liff/edge/versions/2.20.0/sdk.js"></script>
    <script src="https://unpkg.com/vconsole/dist/vconsole.min.js"></script>
    <script>
        var vConsole = new VConsole();
        console.log("vConsoleが起動しました");
    </script>
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <form id="userForm">
        <h1>拠点名を登録してください</h1>

        <div id="loading">お待ちください・・・</div>

        <div id="userInfo" class="form-group" style="display: none;">
            <p id="nickname" class="nickname-display"></p>
            <p>さん、以下より拠点名を選択してください。</p>

            <label for="siteSelect">拠点:</label>
            <select id="siteSelect"></select>

            <div class="button-group">
                <button id="registerBtn">登録</button>
            </div>
        </div>
    </form>

    <script>
        async function registerUser() {
            const siteName = document.getElementById("siteSelect").value;
            
            if (!siteName) {
                alert("拠点を選択してください");
                return;
            }

            try {
                const response = await fetch(BACKEND_URL, {
                    method: "POST",
                    mode: "cors",
                    headers: { "Content-Type": "text/plain" },
                    body: JSON.stringify({
                        action: "registerUser",
                        userId: userId,
                        nickname: displayName,
                        siteName: siteName
                    })
                });

                if (!response.ok) {
                    throw new Error("サーバーエラー");
                }

                const result = await response.json();

                if (result.success) {
                    alert("ユーザ登録が成功しました");
                    window.location.href = `form.html?userId=${userId}`;
                } else {
                    alert("登録に失敗しました: " + JSON.stringify(result));
                }
            } catch (error) {
                console.error("fetchエラー:", error);
                alert("サーバー通信に失敗しました: " + error.message);
            }
        }

        document.getElementById("registerBtn").addEventListener("click", registerUser);
    </script>

</body>
</html>
